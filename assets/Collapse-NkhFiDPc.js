import{r as e,j as E}from"./index-BZRL_YzS.js";import{u as F,f as $,a as L,P as O,L as U,m as N,b as S}from"./spring-ljKDotGJ.js";import{c as T}from"./helper-wV2Sx7aH.js";function I(){const r=e.useRef(!1);return F(()=>(r.current=!0,()=>{r.current=!1}),[]),r}function A(){const r=I(),[s,t]=e.useState(0),n=e.useCallback(()=>{r.current&&t(s+1)},[s]);return[e.useCallback(()=>$.postRender(n),[n]),s]}class D extends e.Component{getSnapshotBeforeUpdate(s){const t=this.props.childRef.current;if(t&&s.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function G({children:r,isPresent:s}){const t=e.useId(),n=e.useRef(null),p=e.useRef({width:0,height:0,top:0,left:0});return e.useInsertionEffect(()=>{const{width:a,height:d,top:l,left:h}=p.current;if(s||!n.current||!a||!d)return;n.current.dataset.motionPopId=t;const f=document.createElement("style");return document.head.appendChild(f),f.sheet&&f.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${a}px !important;
            height: ${d}px !important;
            top: ${l}px !important;
            left: ${h}px !important;
          }
        `),()=>{document.head.removeChild(f)}},[s]),e.createElement(D,{isPresent:s,childRef:n,sizeRef:p},e.cloneElement(r,{ref:n}))}const z=({children:r,initial:s,isPresent:t,onExitComplete:n,custom:p,presenceAffectsLayout:a,mode:d})=>{const l=L(H),h=e.useId(),f=e.useMemo(()=>({id:h,initial:s,isPresent:t,custom:p,onExitComplete:o=>{l.set(o,!0);for(const c of l.values())if(!c)return;n&&n()},register:o=>(l.set(o,!1),()=>l.delete(o))}),a?void 0:[t]);return e.useMemo(()=>{l.forEach((o,c)=>l.set(c,!1))},[t]),e.useEffect(()=>{!t&&!l.size&&n&&n()},[t]),d==="popLayout"&&(r=e.createElement(G,{isPresent:t},r)),e.createElement(O.Provider,{value:f},r)};function H(){return new Map}function V(r){return e.useEffect(()=>()=>r(),[])}const m=r=>r.key||"";function W(r,s){r.forEach(t=>{const n=m(t);s.set(n,t)})}function _(r){const s=[];return e.Children.forEach(r,t=>{e.isValidElement(t)&&s.push(t)}),s}const q=({children:r,custom:s,initial:t=!0,onExitComplete:n,exitBeforeEnter:p,presenceAffectsLayout:a=!0,mode:d="sync"})=>{const l=e.useContext(U).forceRender||A()[0],h=I(),f=_(r);let o=f;const c=e.useRef(new Map).current,g=e.useRef(o),C=e.useRef(new Map).current,y=e.useRef(!0);if(F(()=>{y.current=!1,W(f,C),g.current=o}),V(()=>{y.current=!0,C.clear(),c.clear()}),y.current)return e.createElement(e.Fragment,null,o.map(i=>e.createElement(z,{key:m(i),isPresent:!0,initial:t?void 0:!1,presenceAffectsLayout:a,mode:d},i)));o=[...o];const v=g.current.map(m),M=f.map(m),j=v.length;for(let i=0;i<j;i++){const u=v[i];M.indexOf(u)===-1&&!c.has(u)&&c.set(u,void 0)}return d==="wait"&&c.size&&(o=[]),c.forEach((i,u)=>{if(M.indexOf(u)!==-1)return;const P=C.get(u);if(!P)return;const k=v.indexOf(u);let R=i;if(!R){const K=()=>{c.delete(u);const b=Array.from(C.keys()).filter(x=>!M.includes(x));if(b.forEach(x=>C.delete(x)),g.current=f.filter(x=>{const w=m(x);return w===u||b.includes(w)}),!c.size){if(h.current===!1)return;l(),n&&n()}};R=e.createElement(z,{key:m(P),isPresent:!1,onExitComplete:K,custom:s,presenceAffectsLayout:a,mode:d},P),c.set(u,R)}o.splice(k,0,R)}),o=o.map(i=>{const u=i.key;return c.has(u)?i:e.createElement(z,{key:m(i),isPresent:!0,presenceAffectsLayout:a,mode:d},i)}),e.createElement(e.Fragment,null,c.size?o:o.map(i=>e.cloneElement(i)))},Y=({isOpened:r,className:s,children:t,withBackground:n=!1})=>{const p=e.useMemo(()=>{const a={open:{opacity:1,height:"auto",transition:S},collapsed:{opacity:0,height:0,overflow:"hidden"}};return n&&(a.open.background="hsl(var(--a) / 10%)",a.collapsed.background="hsl(var(--a) / 0%)"),a},[n]);return E.jsx(E.Fragment,{children:E.jsx(q,{initial:!1,children:r&&E.jsx(N.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:p,className:T(n&&"rounded-lg",s),children:n?E.jsx("div",{className:"p-4",children:t}):t},"content")})})};export{q as A,Y as C};
