import{r as m,j as s,R as de,i as Z}from"./index-TmOf46e3.js";import{u as Se,L as Le,D as ie,a as Oe}from"./Divider-GJsDAaXZ.js";import{c as le,s as Re,a as M}from"./helper-H2rpVDS9.js";import{a as D,j as Ne,u as ue,s as Ae,i as He}from"./utils-FrQ42cDA.js";const Te=t=>{const e=m.useRef();return e.current||(e.current=t()),e.current},me=m.createContext(D([])),St=({children:t,images:e})=>{const o=Te(()=>D(e));return m.useEffect(()=>{Ne.set(o,e)},[e]),s.jsx(me.Provider,{value:o,children:t})},ee=t=>ue(Ae(m.useContext(me),m.useCallback(e=>e.find(o=>o.src===t),[t]))),_e=typeof window<"u"?m.useLayoutEffect:m.useEffect,Pe=({contexts:t,children:e})=>t.reduceRight((o,r)=>de.cloneElement(r,{children:o}),e),Q=t=>{const e=m.useRef(t);return m.useEffect(()=>{e.current=t},[t]),e};D(!1);const ke=(t,e,o={})=>{let r,c,i;const g=()=>{r=void 0,c!==void 0&&(t.apply(void 0,c),c=void 0,i=Date.now(),r=setTimeout(g,e))};return function(...l){const z=Date.now();i===void 0&&o.leading===!1&&(i=z);const p=e-(z-(i??0));p<=0||p>e?(r!==void 0&&clearTimeout(r),t.apply(this,l),i=z,r=setTimeout(g,e)):o.trailing!==!1&&(c=l,r===void 0&&(r=setTimeout(g,p)))}},Lt=t=>t[Math.floor(Math.random()*t.length)];D(0);const We=D(null),Me=()=>ue(We),[De,$e,Ue]=Z(void 0),[Fe,Ge,Ye]=Z({h:0,w:0}),[Ze,Ot,qe]=Z({x:0,y:0}),[Be,Rt,Ve]=Z(!1),Xe=[s.jsx(De,{},"ArticleElementProviderInternal"),s.jsx(Fe,{},"ElementSizeProviderInternal"),s.jsx(Ze,{},"ElementPositsionProviderInternal"),s.jsx(Be,{},"IsEOArticleElementProviderInternal")],Nt=({children:t,className:e})=>s.jsxs(Pe,{contexts:Xe,children:[s.jsx(Ke,{}),s.jsx(fe,{className:e,children:t})]}),Ke=()=>{const t=Ye(),e=qe(),o=$e();return _e(()=>{if(!o)return;const{height:r,width:c,x:i,y:g}=o.getBoundingClientRect();t({h:r,w:c}),e({x:i,y:g});const l=new ResizeObserver(z=>{const p=z[0],{height:j,width:S,x:R,y:C}=p.contentRect;t({h:j,w:S}),e({x:R,y:C})});return l.observe(o),()=>{l.unobserve(o),l.disconnect()}},[o]),null},fe=m.memo(({children:t,className:e})=>{const o=Ue();return s.jsxs("div",{className:le("relative",e),ref:o,children:[t,s.jsx(Je,{})]})});fe.displayName="ArticleElementProviderContent";const Je=()=>{const t=Me(),e=Q(t),o=Ve(),r=m.useRef(null);return m.useEffect(()=>{if(!r.current)return;const c=r.current,i=new IntersectionObserver(g=>{const l=g[0];!l.isIntersecting&&e.current==="down"||o(l.isIntersecting)},{rootMargin:"0px 0px 0px 0px"});return i.observe(c),()=>{i.unobserve(c),i.disconnect()}},[]),s.jsx("div",{ref:r})};/*! medium-zoom 1.1.0 | MIT License | https://github.com/francoischalifour/medium-zoom */var T=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r])}return t},F=function(e){return e.tagName==="IMG"},Qe=function(e){return NodeList.prototype.isPrototypeOf(e)},G=function(e){return e&&e.nodeType===1},ae=function(e){var o=e.currentSrc||e.src;return o.substr(-4).toLowerCase()===".svg"},se=function(e){try{return Array.isArray(e)?e.filter(F):Qe(e)?[].slice.call(e).filter(F):G(e)?[e].filter(F):typeof e=="string"?[].slice.call(document.querySelectorAll(e)).filter(F):[]}catch{throw new TypeError(`The provided selector is invalid.
Expects a CSS selector, a Node element, a NodeList or an array.
See: https://github.com/francoischalifour/medium-zoom`)}},et=function(e){var o=document.createElement("div");return o.classList.add("medium-zoom-overlay"),o.style.background=e,o},tt=function(e){var o=e.getBoundingClientRect(),r=o.top,c=o.left,i=o.width,g=o.height,l=e.cloneNode(),z=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,p=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;return l.removeAttribute("id"),l.style.position="absolute",l.style.top=r+z+"px",l.style.left=c+p+"px",l.style.width=i+"px",l.style.height=g+"px",l.style.transform="",l},k=function(e,o){var r=T({bubbles:!1,cancelable:!1,detail:void 0},o);if(typeof window.CustomEvent=="function")return new CustomEvent(e,r);var c=document.createEvent("CustomEvent");return c.initCustomEvent(e,r.bubbles,r.cancelable,r.detail),c},nt=function t(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=window.Promise||function(a){function d(){}a(d,d)},c=function(a){var d=a.target;if(d===$){h();return}E.indexOf(d)!==-1&&N({target:d})},i=function(){if(!(_||!n.original)){var a=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;Math.abs(oe-a)>f.scrollOffset&&setTimeout(h,150)}},g=function(a){var d=a.key||a.keyCode;(d==="Escape"||d==="Esc"||d===27)&&h()},l=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a;if(a.background&&($.style.background=a.background),a.container&&a.container instanceof Object&&(d.container=T({},f.container,a.container)),a.template){var v=G(a.template)?a.template:document.querySelector(a.template);d.template=v}return f=T({},f,d),E.forEach(function(y){y.dispatchEvent(k("medium-zoom:update",{detail:{zoom:x}}))}),x},z=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t(T({},f,a))},p=function(){for(var a=arguments.length,d=Array(a),v=0;v<a;v++)d[v]=arguments[v];var y=d.reduce(function(u,w){return[].concat(u,se(w))},[]);return y.filter(function(u){return E.indexOf(u)===-1}).forEach(function(u){E.push(u),u.classList.add("medium-zoom-image")}),H.forEach(function(u){var w=u.type,O=u.listener,P=u.options;y.forEach(function(A){A.addEventListener(w,O,P)})}),x},j=function(){for(var a=arguments.length,d=Array(a),v=0;v<a;v++)d[v]=arguments[v];n.zoomed&&h();var y=d.length>0?d.reduce(function(u,w){return[].concat(u,se(w))},[]):E;return y.forEach(function(u){u.classList.remove("medium-zoom-image"),u.dispatchEvent(k("medium-zoom:detach",{detail:{zoom:x}}))}),E=E.filter(function(u){return y.indexOf(u)===-1}),x},S=function(a,d){var v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return E.forEach(function(y){y.addEventListener("medium-zoom:"+a,d,v)}),H.push({type:"medium-zoom:"+a,listener:d,options:v}),x},R=function(a,d){var v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return E.forEach(function(y){y.removeEventListener("medium-zoom:"+a,d,v)}),H=H.filter(function(y){return!(y.type==="medium-zoom:"+a&&y.listener.toString()===d.toString())}),x},C=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.target,v=function(){var u={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,left:0,top:0,right:0,bottom:0},w=void 0,O=void 0;if(f.container)if(f.container instanceof Object)u=T({},u,f.container),w=u.width-u.left-u.right-f.margin*2,O=u.height-u.top-u.bottom-f.margin*2;else{var P=G(f.container)?f.container:document.querySelector(f.container),A=P.getBoundingClientRect(),B=A.width,pe=A.height,ve=A.left,ye=A.top;u=T({},u,{width:B,height:pe,left:ve,top:ye})}w=w||u.width-f.margin*2,O=O||u.height-f.margin*2;var W=n.zoomedHd||n.original,ze=ae(W)?w:W.naturalWidth||w,xe=ae(W)?O:W.naturalHeight||O,U=W.getBoundingClientRect(),Ee=U.top,be=U.left,V=U.width,X=U.height,we=Math.min(Math.max(V,ze),w)/V,Ie=Math.min(Math.max(X,xe),O)/X,K=Math.min(we,Ie),je=(-be+(w-V)/2+f.margin+u.left)/K,Ce=(-Ee+(O-X)/2+f.margin+u.top)/K,re="scale("+K+") translate3d("+je+"px, "+Ce+"px, 0)";n.zoomed.style.transform=re,n.zoomedHd&&(n.zoomedHd.style.transform=re)};return new r(function(y){if(d&&E.indexOf(d)===-1){y(x);return}var u=function B(){_=!1,n.zoomed.removeEventListener("transitionend",B),n.original.dispatchEvent(k("medium-zoom:opened",{detail:{zoom:x}})),y(x)};if(n.zoomed){y(x);return}if(d)n.original=d;else if(E.length>0){var w=E;n.original=w[0]}else{y(x);return}if(n.original.dispatchEvent(k("medium-zoom:open",{detail:{zoom:x}})),oe=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,_=!0,n.zoomed=tt(n.original),document.body.appendChild($),f.template){var O=G(f.template)?f.template:document.querySelector(f.template);n.template=document.createElement("div"),n.template.appendChild(O.content.cloneNode(!0)),document.body.appendChild(n.template)}if(n.original.parentElement&&n.original.parentElement.tagName==="PICTURE"&&n.original.currentSrc&&(n.zoomed.src=n.original.currentSrc),document.body.appendChild(n.zoomed),window.requestAnimationFrame(function(){document.body.classList.add("medium-zoom--opened")}),n.original.classList.add("medium-zoom-image--hidden"),n.zoomed.classList.add("medium-zoom-image--opened"),n.zoomed.addEventListener("click",h),n.zoomed.addEventListener("transitionend",u),n.original.getAttribute("data-zoom-src")){n.zoomedHd=n.zoomed.cloneNode(),n.zoomedHd.removeAttribute("srcset"),n.zoomedHd.removeAttribute("sizes"),n.zoomedHd.removeAttribute("loading"),n.zoomedHd.src=n.zoomed.getAttribute("data-zoom-src"),n.zoomedHd.onerror=function(){clearInterval(P),console.warn("Unable to reach the zoom image target "+n.zoomedHd.src),n.zoomedHd=null,v()};var P=setInterval(function(){n.zoomedHd.complete&&(clearInterval(P),n.zoomedHd.classList.add("medium-zoom-image--opened"),n.zoomedHd.addEventListener("click",h),document.body.appendChild(n.zoomedHd),v())},10)}else if(n.original.hasAttribute("srcset")){n.zoomedHd=n.zoomed.cloneNode(),n.zoomedHd.removeAttribute("sizes"),n.zoomedHd.removeAttribute("loading");var A=n.zoomedHd.addEventListener("load",function(){n.zoomedHd.removeEventListener("load",A),n.zoomedHd.classList.add("medium-zoom-image--opened"),n.zoomedHd.addEventListener("click",h),document.body.appendChild(n.zoomedHd),v()})}else v()})},h=function(){return new r(function(a){if(_||!n.original){a(x);return}var d=function v(){n.original.classList.remove("medium-zoom-image--hidden"),document.body.removeChild(n.zoomed),n.zoomedHd&&document.body.removeChild(n.zoomedHd),document.body.removeChild($),n.zoomed.classList.remove("medium-zoom-image--opened"),n.template&&document.body.removeChild(n.template),_=!1,n.zoomed.removeEventListener("transitionend",v),n.original.dispatchEvent(k("medium-zoom:closed",{detail:{zoom:x}})),n.original=null,n.zoomed=null,n.zoomedHd=null,n.template=null,a(x)};_=!0,document.body.classList.remove("medium-zoom--opened"),n.zoomed.style.transform="",n.zoomedHd&&(n.zoomedHd.style.transform=""),n.template&&(n.template.style.transition="opacity 150ms",n.template.style.opacity=0),n.original.dispatchEvent(k("medium-zoom:close",{detail:{zoom:x}})),n.zoomed.addEventListener("transitionend",d)})},N=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.target;return n.original?h():C({target:d})},q=function(){return f},I=function(){return E},L=function(){return n.original},E=[],H=[],_=!1,oe=0,f=o,n={original:null,zoomed:null,zoomedHd:null,template:null};Object.prototype.toString.call(e)==="[object Object]"?f=e:(e||typeof e=="string")&&p(e),f=T({margin:0,background:"#fff",scrollOffset:40,container:null,template:null},f);var $=et(f.background);document.addEventListener("click",c),document.addEventListener("keyup",g),document.addEventListener("scroll",i),window.addEventListener("resize",h);var x={open:C,close:h,toggle:N,update:l,clone:z,attach:p,detach:j,on:S,off:R,getOptions:q,getImages:I,getZoomedImage:L};return x};function ot(t,e){e===void 0&&(e={});var o=e.insertAt;if(!(!t||typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css",o==="top"&&r.firstChild?r.insertBefore(c,r.firstChild):r.appendChild(c),c.styleSheet?c.styleSheet.cssText=t:c.appendChild(document.createTextNode(t))}}var rt=".medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)!important}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}";ot(rt);const it=nt,at=t=>de.createElement("img",t,t.children),st=({width:t,height:e,max:o})=>{if(t===0||e===0)throw new Error("Invalid image size");const{width:r,height:c}=o,i=r/t||1,g=c/e||1,l=Math.min(i,g,1);return{width:t*l,height:e*l}},ct="_error_hef56_1",dt="_loading_hef56_2",lt="_loaded_hef56_6",ut="_imageLoad_hef56_1",ce={error:ct,loading:dt,loaded:lt,imageLoad:ut},te=Re({base:"rounded-xl overflow-hidden text-center inline-flex items-center justify-center duration-200",variants:{status:{loading:"hidden opacity-0",loaded:"opacity-100 block",error:"hidden opacity-0"}}});let J;const mt=({alt:t,src:e,title:o,zoom:r,placeholder:c,height:i,width:g})=>{const[l]=m.useState(()=>{if(He)return null;if(J)return J;const h=it(void 0);return J=h,h}),z=o||t,[p,j]=m.useState("loading"),S=Se(),R=m.useCallback(h=>{S.current||j(h)},[S]),C=m.useRef(null);return m.useEffect(()=>{if(p!=="loaded"||!r)return;const h=C.current;if(h)return l.attach(h),()=>{l.detach(h)}},[r,l,p]),s.jsxs("figure",{children:[s.jsx("span",{className:"relative flex justify-center","data-hide-print":!0,children:s.jsxs(Le,{placeholder:c,offset:30,children:[s.jsx("span",{children:p!=="loaded"&&c}),p==="error"&&s.jsxs("div",{className:"absolute inset-0 z-[1] flex flex-col gap-8 center",children:[s.jsx("i",{className:"icon-[mingcute--close-line] text-4xl text-red-500"}),s.jsx("span",{children:"图片加载失败"}),s.jsx(ie,{className:"w-[80px] opacity-80"}),s.jsx("a",{href:e,target:"_blank",rel:"noreferrer",children:s.jsx("span",{children:"查看原图"})})]}),s.jsx(he,{height:i,width:g,src:e,title:o,alt:t||o||"",ref:C,onLoad:()=>{R("loaded")},onError:()=>R("error"),className:te({status:p,className:ce.loaded}),onAnimationEnd:h=>{h.target.classList.remove(ce.loaded)}})]})}),s.jsx("img",{className:"max-w-1/3 hidden print:block",src:e,alt:t||o}),!!z&&s.jsxs("figcaption",{className:"mt-1 flex flex-col items-center justify-center",children:[s.jsx(ie,{className:"w-[80px] opacity-80"}),s.jsx("span",{children:z})]})]})},ft=t=>{const e=m.useMemo(()=>s.jsx(ht,{...t}),[t]);return s.jsx(mt,{zoom:!0,placeholder:e,...t})},ht=({src:t,containerWidth:e,height:o,width:r,accent:c})=>{const i=ee(t),g=c||(i==null?void 0:i.accent),l=m.useMemo(()=>{let z=o,p=r;if(!z||!p){if(!i)return;z=i.height,p=i.width}if(e<=0)return;const{height:j,width:S}=st({width:p,height:z,max:{width:e,height:1/0}});return{scaleHeight:j,scaleWidth:S}},[o,r,e,i]);return l?s.jsx("span",{className:`image-placeholder ${te.base}`,"data-width":l.scaleWidth,"data-height":l.scaleHeight,"data-from-record-height":i==null?void 0:i.height,"data-from-record-width":i==null?void 0:i.width,"data-src":t,style:{height:l.scaleHeight,width:l.scaleWidth,backgroundColor:g}}):s.jsx(gt,{accent:g})},gt=({accent:t})=>s.jsx("span",{className:le("image-placeholder",te.base,"h-[300px] w-full bg-slate-300 dark:bg-slate-700"),style:{backgroundColor:t,outline:void 0}}),he=m.forwardRef(({src:t,alt:e,...o},r)=>{const{height:c,width:i}=ee(t)||o;return!c||!i?s.jsx("img",{alt:e,src:t,ref:r,...o}):s.jsx(at,{alt:e||"",fetchPriority:"high",priority:!0,src:t,...o,height:+c,width:+i,ref:r})});he.displayName="OptimizedImage";const pt="_root_1ug9l_1",vt="_indicator_1ug9l_2",yt="_container_1ug9l_7",zt="_child_1ug9l_17",Y={root:pt,indicator:vt,container:yt,child:zt},ne=60,xt=15,Et=5e3,At=t=>{const{images:e}=t,[o,r]=m.useState(null),[,c]=m.useState({}),i=m.useRef(0);m.useEffect(()=>{if(!o)return;const I=new ResizeObserver(()=>{c({}),L(o)});function L(E){const H=E.children.item(0);H&&(i.current=H.clientWidth)}return L(o),I.observe(o),()=>{I.disconnect()}},[o]);const[g,l]=m.useState(0),z=m.useCallback(ke(I=>{const L=I.target,E=Math.floor((L.scrollLeft+ne+15)/i.current);l(E)},60),[]),p=m.useCallback(I=>{o&&o.scrollTo({left:i.current*I,behavior:"smooth"})},[o]),j=m.useRef(null),S=Q(g),R=Q(e.length),C=m.useRef(!0),h=m.useRef(!0),N=m.useCallback(()=>{h.current&&(h.current=!1,clearInterval(j.current))},[]),{ref:q}=Oe({initialInView:!1,triggerOnce:e.length<2,onChange(I){R.current<2||!h.current||(I?j.current=setInterval(()=>{S.current+1>R.current-1&&C.current&&(C.current=!1),S.current-1<0&&!C.current&&(C.current=!0);const L=S.current+(C.current?1:-1);p(L)},Et):j.current=clearInterval(j.current))}});return m.useEffect(()=>()=>{clearInterval(j.current)},[]),s.jsxs("div",{className:M("w-full","relative",Y.root),ref:q,onTouchMove:N,onWheel:N,children:[s.jsx("div",{className:M("w-full overflow-auto whitespace-nowrap",Y.container),onTouchStart:N,onScroll:z,ref:r,onTouchMove:N,onWheel:N,children:e.map(I=>s.jsx(ge,{image:I},I.url))}),s.jsx("div",{className:M(Y.indicator,"space-x-2"),children:Array.from({length:e.length}).map((I,L)=>s.jsx("div",{className:M("h-[6px] w-[6px] cursor-pointer rounded-full bg-stone-600 opacity-50 transition-opacity duration-200 ease-in-out",g==L&&"!opacity-100"),onClick:p.bind(null,L)},L))})]})},bt={width:`calc(100% - ${ne}px)`,marginRight:`${xt}px`},ge=m.memo(({image:t})=>{const e=ee(t.url),o=t.name,c=t.footnote||(["!","¡"].some(g=>g==(o==null?void 0:o[0]))?o==null?void 0:o.slice(1):"")||"",{w:i}=Ge();return s.jsx("div",{style:bt,className:M(Y.child,"inline-block self-center"),children:s.jsx(ft,{accent:e==null?void 0:e.accent,src:t.url,alt:c,containerWidth:i-ne})},`${t.url}-${t.name||""}`)});ge.displayName="GalleryItem";export{ft as F,At as G,at as I,St as M,Nt as W,Te as a,Lt as s,Ge as u};
